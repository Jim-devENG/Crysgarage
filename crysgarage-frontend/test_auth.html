<!DOCTYPE html>
<html>
  <head>
    <title>Auth Test</title>
  </head>
  <body>
    <h1>Authentication Test</h1>
    <button onclick="testAuth()">Test Authentication</button>
    <button onclick="testUpload()">Test Upload</button>
    <div id="output"></div>

    <script>
      const API_BASE_URL = "http://localhost:8000/api";

      async function testAuth() {
        const output = document.getElementById("output");
        output.innerHTML = "<p>Testing authentication...</p>";

        try {
          // First, sign in
          const signInResponse = await fetch(`${API_BASE_URL}/auth/signin`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email: "test@example.com",
              password: "password123",
            }),
          });

          const signInData = await signInResponse.json();
          output.innerHTML += `<p>Sign in response: ${JSON.stringify(
            signInData
          )}</p>`;

          if (signInData.token) {
            localStorage.setItem("crysgarage_token", signInData.token);
            output.innerHTML += `<p>Token stored: ${signInData.token}</p>`;

            // Test user endpoint
            const userResponse = await fetch(`${API_BASE_URL}/user`, {
              headers: {
                Authorization: `Bearer ${signInData.token}`,
                "Content-Type": "application/json",
              },
            });

            const userData = await userResponse.json();
            output.innerHTML += `<p>User data: ${JSON.stringify(userData)}</p>`;
          }
        } catch (error) {
          output.innerHTML += `<p>Error: ${error.message}</p>`;
        }
      }

      async function testUpload() {
        const output = document.getElementById("output");
        output.innerHTML += "<p>Testing upload...</p>";

        try {
          const token = localStorage.getItem("crysgarage_token");
          if (!token) {
            output.innerHTML += "<p>No token found. Please sign in first.</p>";
            return;
          }

          // Create a test file
          const testData = new Uint8Array(1000);
          const testFile = new File([testData], "test.wav", {
            type: "audio/wav",
          });

          const formData = new FormData();
          formData.append("audio", testFile);
          formData.append("genre", "afrobeats");

          const uploadResponse = await fetch(`${API_BASE_URL}/upload`, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          });

          const uploadData = await uploadResponse.json();
          output.innerHTML += `<p>Upload response: ${JSON.stringify(
            uploadData
          )}</p>`;
        } catch (error) {
          output.innerHTML += `<p>Upload error: ${error.message}</p>`;
        }
      }
    </script>
  </body>
</html>
